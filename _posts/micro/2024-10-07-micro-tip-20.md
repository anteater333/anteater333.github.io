---
layout: post
title: "자잘한 도움말 #20 Next.js SSG에서 시스템 다크 모드 설정 가져오기"
subtitle: ""
description: ""
date: 2024-10-07 21:55:00 +0900
category: micro

id: 20
slug: system-dark-mode-in-next-js-ssg
tags: [💡, Front-end, Web Browser]

coverImage: "/assets/blog/coverImages/micro-20.png"

ogImage:
  url: "/assets/blog/coverImages/micro-20.png"
---

## TL;DR

## 이하 그리 중요하진 않은 내용들

## 내가 배운 것

----

- 주제를 어디에 중점을 둘 것인가
  - 다크모드 설정하는 방법?
  - SSG 개발 시 발생할 수 있는 문제점?
  - 상태관리 라이브러리 사용 변천사?
- 일단 주제는 Nextjs SSG에 초점을 둡시다.
  - 기존 블로그를 바꾼 이유
  - 왜 Nextjs인가
  - 왜 SSG인가
  - SSG로 개발하면서 골치아팠던 문제
    - 빌드시점 상태와 클라이언트의 상태가 다른 현상
      - 이게 왜 문제가 되는가? 도 조사할 것.

- 페이지 로드 시 시스템 다크모드 설정을 가져와 페이지에 먼저 적용하고 싶은데
  - useStore등의 기능은 hook으로, 클라이언트사이드 기능
  - registry 모듈을 통해 페이지 로드 시의 초기 세팅을 설정한다.
  - 근데 그럼 결국 registry들은 클라이언트 컴포넌트들?
  - 클라이언트 컴포넌트 안에 서버 컴포넌트가 들어가는 구조가 괜찮은가요?
  - https://www.inflearn.com/community/questions/1118233/%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%9E%90%EC%8B%9D%EC%9C%BC%EB%A1%9C-%EC%84%9C%EB%B2%84-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EB%A5%BC-%EB%84%A3%EC%97%88%EC%9D%84-%EB%95%8C%EC%9D%98-%EC%9B%90%EB%A6%AC%EC%97%90-%EB%8C%80%ED%95%B4%EC%84%9C-%EC%A7%88%EB%AC%B8%EC%9E%88%EC%8A%B5%EB%8B%88%EB%8B%A4?srsltid=AfmBOoq8paJs7TAe8CSepB6O-JT8JN7TCWH3Bk9xs4guynaFqMEEAOsn
  - When a new request is made to the server, all Server Components are rendered first, including those nested inside Client Components.
    - https://nextjs.org/docs/app/building-your-application/rendering/composition-patterns


- 실제 사용 코드

```javascript
import { useEffect } from "react";
import { create } from "zustand";

type Store = {
  isDarkMode: boolean;
  toggleDark: () => void;
  setIsDarkMode: (isDarkMode: boolean) => void;
};

const useStore = create<Store>()((set) => {
  return {
    isDarkMode: false,
    toggleDark: () => set((state) => ({ isDarkMode: !state.isDarkMode })),
    setIsDarkMode: (isDarkMode) => set((state) => ({ isDarkMode })),
  };
});

export const useDarkMode = () => {
  const { isDarkMode, toggleDark, setIsDarkMode } = useStore();

  // useStore에서 바로 window 객체의 존재 여부를 파악하며 isDarkMode를 결정지을 경우
  // 서버사이드 렌더링과 클라이언트 사이드 렌더링의 초기 상태 차이로 인해 오류를 발생시킴
  // 먼저 상태 생성 후 -> useEffect 훅으로 시스템 설정을 확인
  useEffect(() => {
    const mediaQueryList = window.matchMedia("(prefers-color-scheme: dark)");
    const updateDarkMode = (e: MediaQueryListEvent) => {
      setIsDarkMode(e.matches);
    };

    // 초기 상태 설정
    setIsDarkMode(mediaQueryList.matches);

    // 리스너 등록
    mediaQueryList.addEventListener("change", updateDarkMode);

    // 컴포넌트 언마운트 시 리스너 제거
    return () => {
      mediaQueryList.removeEventListener("change", updateDarkMode);
    };
  }, []);

  return { isDarkMode, toggleDark };
};

export default useStore;
```