---
layout: post
title: "자잘한 도움말 #19 사파리는 나의 원수"
subtitle: "Safari 브라우저를 사용하며 겪은 두 가지 오류와 해결 방안"
description: ""
date: 2024-09-06 14:00:00 +0900
category: micro

id: 19
slug: i-do-not-like-safari
tags: [💡, Front-end, Web Browser]

coverImage: "/assets/blog/coverImages/micro-19.png"

ogImage:
  url: "/assets/blog/coverImages/micro-19.png"
---

## TL;DR

<p class="center">
(2024년 9월 기준)
</p>

1. 문자열을 날짜로 파싱할 때의 오류
   - Safari 브라우저에선 다음과 같은 문자열을 `Date` 객체로 파싱하지 못한다.
    ```javascript
        new Date("2024-08-17 11:02:00 +0900"); // -> Invalid Date
    ```
    - Safari 브라우저의 날짜 파싱 알고리즘에선 날짜 표기법을 엄격하게 따진다.
    - 날짜를 표시하는 문자열을 사용할 때 <a href="https://ko.wikipedia.org/wiki/ISO_8601">ISO 8601</a> 표준을 따르도록 하자
     ```javascript
        new Date("2024-08-17T11:02:00+09:00"); // -> 👍
     ```
2. 음수 스크롤
   - Safari 브라우저에선 기본으로 웹 페이지에 탄력있는 스크롤 효과를 준다.  
     (**Elastic Overflow Scrolling** 혹은 **Rubber band** 효과)
   - 이때 `window.scrollY`의 값이 음수가 될 수도 있다.
   - `window.scrollY` 값을 기반으로 배열 인덱스를 계산하는 경우 등 특정 상황에서 오류를 야기하기도 한다.

- 이처럼 브라우저의 종류에 따라 예상하지 못한 부분에서 오류를 겪을 수 있다.
- 웹 페이지를 개발할 땐 최대한 다양한 웹 브라우저에서 테스트를 진행할 수 있도록 하자.

## 이하 그리 중요하진 않은 내용들

<p class="line-through align-right middle-small" style="line-height:1">아니 근데 이거 다 사파리에서 직접 패치해야 하는 내용들 아닌가?
<br/>
오늘 글에 나오는 비난과 심술은 모두 농담입니다 사파리 그렇게까지 싫어하는건 아니에요.
</p>

<p class="center w-half rounded-edge-16">
  <img src="/assets/blog/coverImages/micro-19.png"/>
</p>

내 개발 PC를 맥북으로 바꾼지도 이제 몇 개월이나 지났다. 사실 아직도 기존에 쓰던 씽크패드 + Windows + WSL 조합에 비해 좀 불편하긴 하다. 개발자 입장에서의 사용성 측면은 그럭저럭 금방 적응 할만하지만, 아무래도 PC라는 물건이 근 20년간 나에게 Windows OS 기반으로만 동작해왔었는데 이걸 바꾸려니 영. 아니 그리고 진짜 객관적으로 불편한거 많아. 한영 전환의 미묘한 딜레이 때문에 몇 번이고 전환 키를 다시 누르질 않나, Notion이나 VSCode 같은 도구를 쓸때도 받침이 하나씩 씹히는 바람에 번거롭게 영어로 한 번 바꿔줬다가 다시 한글로 써야지 그제야 증상이 사라지고, 간헐적으로 웹 브라우저에 입력한 검색어가 깨진 상태로 요청 파라미터에 들어가기도 한다. 하지만 오늘 해볼 이야기의 주인공은 macOS가 아니다. 오늘의 주인공은 애플 진영의 대표 웹 브라우저 **사파리(Safari)**.

### Safari is the new Internet Explorer

IT 분야에서 플랫폼에 따라 파벌이 나뉘고 갈등이 생기는 일은 허다하다. 사람들도 거참 애플 쓴다고 뭐라 하고, 갤럭시 쓴다고 뭐라 하고, 맥북 쓴다고 뭐라 하고, 맥북 안쓴다고 뭐라 하고... 그리고 그들 말고도 알게 모르게 사용자들 간의 신경전이 살벌한 곳이 또 있으니 바로 웹 브라우저의 세계다. 무려 "<a href="https://ko.wikipedia.org/wiki/브라우저_전쟁">전쟁</a>"이라고 표현할 수준의 시장 경쟁을 두 차례나 벌여온 역사를 가지고 있을 정도.

<p class="center w-half">
  <img src="https://i.postimg.cc/bwjktR7t/image.png" />
  <br/>
  역시 나만 이렇게 생각한게 아니었어
</p>

그 중 두번째 전쟁에서 타도의 대상이 되었던 브라우저가 마이크로소프트의 그 유명한 인터넷 익스플로러(Internet Explorer)였다. 한떄 전국민적 공분을 샀던 이 브라우저는 결국 2024년 오늘날엔 역사 속으로 사라진 신세가 되었지만, 애플의 사파리 브라우저의 뒤에서 그 이름이 다시금 소환되고 있는 이유는 무엇일까. "<a href="https://www.google.com/search?q=safari+is+the+new+internet+explorer">Safari is the new Internet Explorer</a>"라는 문장을 구글에 검색하면 이 브라우저에 대한 다양한 성토들, 그리고 손수 도메인 까지 구매해서 사파리를 규탄하고 있는 웹 사이트까지 발견할 수 있다.

#### 개발자의 입장

다만 사파리에 대한 비판은 아직까진 개발자 커뮤니티 내부의 목소리 정도로 느껴진다. 인터넷 익스플로러는 그 불편함의 마수가 일반 사용자에게까지 뻗쳤기 때문에 결국 명을 다했다. 솔직히 사파리 쓴다고 갑자기 ActiveX 설치하라 하고 `.exe` 프로그램 설치하라 하는 수준까진 아니잖아. 사파리가 비판 받고 있는 가장 큰 이유를 보자.

<p class="center">
  <a href="https://ecosystem-infra.github.io/wpt-results-analysis/">
    <img src="https://i.postimg.cc/sxP7cZPD/image.png"/>
    <br/>
    출처
  </a>
</p>

이 그래프는 대표적인 세 웹 브라우저의 웹 표준 테스트 실패 수를 나타낸다. 사파리 혼자 그 수가 눈에 띄게 차이나는 것을 볼 수 있다. 사파리의 문제는 사용하기 불편하다는 것이 아니다. 사파리는 구현이 덜 되었고, 구현이 다른 브라우저와 다르게 되어있다. 

<p class="center">
  <a href="https://gs.statcounter.com">
    <img src="https://i.postimg.cc/pdCM2Bjv/image.png"/>
    <br/>
    출처
  </a>
</p>

그런 와중에 사파리는 전체 브라우저 중 점유율 2위라는 위치를 차지하고 있다. 개발자들의 불만을 한껏 받고 있는 이유도 이것이다. 혼자만 동작이 다른데 차라리 얘가 시장을 지배하고 있는 것도 아니고, 그렇다고 무시하기엔 너무 파이가 크다. "사이트가 이상해요" 라는 고객 문의에다 "사파리 쓰지 마세요"라고 답변할 수 없는 웹 개발자들은 오늘도 사파리의 이상한 동작을 보완하기 위한 예외 처리 코드를 작성하고 있다. CSS `--webkit-` 접두사 같은거 말야.

게다가 애플은 10년도 더 전에 이미 사파리의 윈도우 OS 지원을 끊어버렸다. 나는 윈도우 쓰는 동안 내 사이트가 사파리에서 오류를 뱉고 있는지 까맣게 몰랐던 것. 앞서 말했듯 나는 맥북의 사용성에 아직도 불만이 있는 상태지만 다음 개발 PC도 눈물을 머금고 맥북으로 사야 할 것 만 같다.

아무튼 요점은 묵묵히 맡은 바 개발을 다해야 할 개발자로서 불평하지 말고 최대한 다양한 웹 브라우저를 지원할 수 있도록 하자는 것. <a href="https://engineering.linecorp.com/ko/blog/the-baseline-for-web-development-in-2022">이 글을 쓰면서 많은 부분을 참고하고 있는 글</a>에서도 웹 개발에서 웹 표준 측면의 기준을 2년 전 버전 사파리 환경에 맞출 것을 제안하고 있다. 절대 사파리 브라우저를 규탄하는 글이 아니라는 것을 다시금 언급하며 다음으로 넘어가자.

### 사파리에서 발견한 두 가지 오류

#### 문자열을 날짜로 파싱할 때의 오류

#### 음수 스크롤

---

<!-- <div class="sandbox-container">
<iframe src="https://codesandbox.io/embed/cmcfx9?view=preview&module=%2Fsrc%2Fscript.mjs"
     style="width:100%; height: 500px; border:0; border-radius: 4px; overflow:hidden;"
     title="hello-safari"
     allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking"
     sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
   ></iframe>
</div>

<p>
  <img src="https://i.postimg.cc/kgkgWmbp/elasticoverflow.webp"/>
</p> -->


## 내가 배운 것

- **Safari RangeError: Invalid time value**
  
    - 같은 문자열을 파싱해도 크롬은 하는데 사파리는 못해… (Node.js도 하고 파이어폭스도 한다)
    
    
    - 이와중에 Velog 조차도 사파리에서 안들어가지는 문제를 발견함
    - 이쯤되면 사파리 왜 써야 하는건지…
    - 이거 말고도 Safari에서만 발견할 수 있었던 신박한 오류를 같이 묶어서 해보자
        - 음수 스크롤;;



https://engineering.linecorp.com/ko/blog/the-baseline-for-web-development-in-2022