---
layout: post
title: "자잘한 도움말 #22 Next.js에서 서버와 클라이언트의 괴리감 처리하기"
subtitle: "Hydration Mismatch"
description: ""
date: 2025-03-17 08:40:00 +0900
category: micro

id: 22
slug: hydration-mismatch
tags: [💡, Front-end, Next.js]

coverImage: "/assets/blog/coverImages/micro-21.png"

ogImage:
  url: "/assets/blog/coverImages/micro-21.png"
---

- Hydration Mismatch
    - Next.js 사용 시 문제
    - 대표적으로 new Date()
    - https://blog.hwahae.co.kr/all/tech/13604
    - 무시할 수 있는 hydration mismatch new Date
    - 무시할 수 없는 hydration mismatch 테마 (store 초기 설정시 로컬 스토리지에 저장된 테마 가져오는 코드에서 발생한 문제, 83ec7fb67b21fb3ebf32ec49e6c1a60ba66f6b67 커밋 참고) -> 이건 보류
- `suppressHydrationWarning` 한 줄 추가로 해결 가능하다. (하지만 이건 에러를 무시하는 방법?)
- 클라이언트에서만 결과가 나오도록 만든다? (훅을 사용해서)
- 하이드레이션이란?? -> Hack the terms로 가려다가 그냥 여기서 다뤄보면 좋을 것 같음

- 서버에 있는 렌더링된 결과 vs 클라이언트에서 렌더링된 결과가 서로 달라서 생기는 문제

- 왜 문제가 되는가?? (by copilot)  

```
Hydration mismatch는 서버에서 렌더링된 HTML과 클라이언트에서 React가 초기화될 때 생성된 HTML이 일치하지 않을 때 발생합니다. 이는 여러 가지 문제를 일으킬 수 있습니다:

사용자 경험 문제:

사용자가 페이지를 로드할 때 깜빡임이나 레이아웃이 갑자기 변경되는 현상이 발생할 수 있습니다. 이는 사용자 경험을 저하시킬 수 있습니다.
SEO 문제:

서버에서 렌더링된 HTML이 검색 엔진에 의해 인덱싱되기 때문에, 클라이언트 측에서 다른 HTML이 렌더링되면 검색 엔진이 잘못된 정보를 인덱싱할 수 있습니다.
디버깅 어려움:

Hydration mismatch는 디버깅하기 어려운 문제 중 하나입니다. 서버와 클라이언트의 상태가 다를 때 발생할 수 있는 문제를 추적하고 해결하는 데 많은 시간이 소요될 수 있습니다.
성능 문제:

Hydration mismatch가 발생하면 React는 클라이언트 측에서 전체 DOM을 다시 렌더링해야 할 수 있습니다. 이는 성능 저하를 초래할 수 있습니다.
이를 방지하기 위해 서버와 클라이언트에서 동일한 상태와 데이터를 사용하여 일관된 HTML을 생성하는 것이 중요합니다. 예를 들어, 서버에서 데이터를 가져와 렌더링할 때와 클라이언트에서 동일한 데이터를 사용하여 렌더링할 때 일관성을 유지해야 합니다.

다음은 Hydration mismatch를 방지하기 위한 몇 가지 팁입니다:

동일한 데이터 소스 사용:

서버와 클라이언트 모두 동일한 데이터 소스를 사용하여 렌더링합니다.
조건부 렌더링 최소화:

서버와 클라이언트에서 조건부 렌더링을 최소화하여 일관된 HTML을 생성합니다.
동일한 상태 관리:

서버와 클라이언트에서 동일한 상태 관리 라이브러리를 사용하여 상태를 일관되게 유지합니다.
환경 변수 사용:

서버와 클라이언트에서 동일한 환경 변수를 사용하여 일관된 설정을 유지합니다.
이러한 방법을 통해 Hydration mismatch 문제를 방지하고, 서버와 클라이언트에서 일관된 HTML을 생성할 수 있습니다.
```


https://nextjs.org/docs/messages/react-hydration-error

- A server/client branch `if (typeof window !== 'undefined')`.
- Variable input such as `Date.now()` or `Math.random()` which changes each time it's called.
- Date formatting in a user's locale which doesn't match the server.
- External changing data without sending a snapshot of it along with the HTML.
- Invalid HTML tag nesting.

- 근데 왜 SSG에서 이런 에러가 떴을까? (빌드 후에도 콘솔에 출력되는 에러 Minified React error #418)



```tsx
import { format } from "date-fns";

type Props = {
  dateString: string;
};

const DateFormatter = ({ dateString }: Props) => {
  // Safari의 parsing 알고리즘이 유독 저열하기 때문에 전처리
  const date = new Date(
    Date.parse(dateString.replace(" ", "T").replace(" ", ""))
  );

  return (
    <time dateTime={dateString} suppressHydrationWarning>
      {format(date, "LLLL	d, yyyy")}
    </time>
  );
};

export default DateFormatter;
```

## TL;DR

## 이하 그리 중요하진 않은 내용들

## 내가 배운 것
